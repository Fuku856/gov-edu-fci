# GitHub認証のトラブルシューティングガイド

## よくあるエラーと解決方法

### エラー1: `auth/account-exists-with-different-credential`

**エラーメッセージ:**
```
Firebase: An account already exists with the same email address but different sign-in credentials.
```

**原因:**
同じメールアドレスで既にGoogleアカウントが登録されている場合に発生します。Firebase Authenticationでは、同じメールアドレスで異なる認証プロバイダー（GoogleとGitHub）を使用することはできません。

**解決方法:**

#### 方法1: 既存のGoogleアカウントにGitHub認証をリンク（推奨）

1. **Googleアカウントでログイン**
   - ログインページで「Googleでログイン」ボタンをクリック
   - 既存のGoogleアカウントでログイン

2. **GitHub認証をリンク**
   - ログイン後、ブラウザの開発者ツール（F12）を開く
   - コンソールタブで以下のコマンドを実行:
     ```javascript
     linkGitHubProvider()
     ```
   - GitHubの認証画面が表示されるので、認証を完了

3. **確認**
   - リンクが成功すると、今後はGoogleアカウントまたはGitHubアカウントのどちらでもログインできるようになります

#### 方法2: GitHubアカウントで別のメールアドレスを使用

1. **GitHubアカウントの設定を変更**
   - GitHubにログイン
   - Settings > Emails にアクセス
   - プライマリメールアドレスを変更するか、追加のメールアドレスを追加
   - 新しいメールアドレスを検証

2. **GitHub認証でログイン**
   - 変更したメールアドレスでGitHub認証を使用
   - このメールアドレスが既存のGoogleアカウントと異なることを確認

#### 方法3: 既存のGoogleアカウントを削除してからGitHub認証を使用

⚠️ **注意**: この方法は既存のデータを失う可能性があります。

1. **Firebase Consoleでユーザーを削除**
   - Firebase Console > Authentication > Users
   - 既存のGoogleアカウントを削除

2. **GitHub認証でログイン**
   - 削除後、GitHub認証でログイン

### エラー2: `auth.local.js` のMIMEタイプエラー

**エラーメッセージ:**
```
MIME タイプ ("text/html") の不一致により "auth.local.js" からのリソースがブロックされました
```

**原因:**
`auth.local.js`は開発用のファイルで、本番環境には存在しません。ファイルが存在しない場合、404エラーが返され、HTMLページが返されるため、この警告が表示されます。

**解決方法:**
このエラーは**無視しても問題ありません**。`auth.local.js`は開発用の設定ファイルで、本番環境では使用されません。

もし警告を非表示にしたい場合は、HTMLファイルから以下の行を削除してください:

```html
<script src="auth.local.js" onerror="console.log('auth.local.js が見つかりません（開発用ファイルです）')"></script>
```

### エラー3: ポップアップがブロックされる

**エラーメッセージ:**
```
auth/popup-blocked: ポップアップがブロックされています
```

**原因:**
ブラウザのポップアップブロッカーが認証ポップアップをブロックしています。

**解決方法:**

1. **ポップアップブロッカーを無効化**
   - ブラウザの設定で、このサイトのポップアップを許可
   - アドレスバーのポップアップブロックアイコンをクリックして許可

2. **リダイレクト方式を使用（将来の実装）**
   - ポップアップ方式の代わりに、リダイレクト方式を使用
   - 現在は実装されていませんが、必要に応じて追加可能

### エラー4: 許可されていないGitHubアカウント

**エラーメッセージ:**
```
このサイトは学校関係者または開発者のみがアクセスできます。
許可されていないGitHubアカウントです。
```

**原因:**
GitHubアカウントが開発者用の許可リストに追加されていません。

**解決方法:**

1. **`firebase-config.js`を編集**
   - `ALLOWED_GITHUB_USERNAMES`または`ALLOWED_GITHUB_EMAILS`にGitHubユーザー名またはメールアドレスを追加

2. **変更をデプロイ**
   - 変更をコミットしてデプロイ
   - デプロイ後、再度GitHub認証でログインを試みる

## 開発者向け: アカウントのリンク方法

既存のGoogleアカウントにGitHub認証をリンクするには、以下の手順に従います:

### ステップ1: Googleアカウントでログイン

1. ログインページで「Googleでログイン」をクリック
2. Googleアカウントでログイン

### ステップ2: GitHub認証をリンク

1. ブラウザの開発者ツール（F12）を開く
2. コンソールタブで以下のコマンドを実行:

```javascript
linkGitHubProvider()
```

3. GitHubの認証画面が表示されるので、認証を完了

### ステップ3: 確認

リンクが成功すると、今後は以下のいずれかでログインできます:
- Googleアカウント
- GitHubアカウント

## よくある質問

### Q: GoogleアカウントとGitHubアカウントで異なるメールアドレスを使用できますか？

A: はい、可能です。異なるメールアドレスを使用すれば、それぞれ別のアカウントとして登録されます。

### Q: 既存のGoogleアカウントにGitHub認証をリンクすると、どちらのアカウントでもログインできますか？

A: はい、リンク後はGoogleアカウントとGitHubアカウントのどちらでもログインできます。

### Q: リンクを解除することはできますか？

A: はい、Firebase Console > Authentication > Users でユーザーを選択し、リンクされたプロバイダーを解除できます。

### Q: 複数のGitHubアカウントをリンクできますか？

A: いいえ、1つのFirebaseアカウントにリンクできるGitHubアカウントは1つだけです。

## サポート

問題が解決しない場合は、以下を確認してください:

1. Firebase ConsoleでGitHub認証が有効になっているか
2. GitHub OAuth Appの設定が正しいか
3. `firebase-config.js`の許可リストに正しく追加されているか
4. ブラウザのコンソールにエラーメッセージがないか

詳細なセットアップ手順は `GITHUB_AUTH_SETUP.md` を参照してください。

