<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ç”Ÿå¾’ä¼šæ´»å‹•è³‡é‡‘</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.1);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.1);
        }
        .chart-container h3 {
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
        }
        .no-data {
            text-align: center;
            color: var(--text-light);
            padding: 3rem;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">ğŸ« ç”Ÿå¾’ä¼š è¦‹ãˆã‚‹åŒ–</a>
            <ul class="nav-links">
                <li><a href="index.html">ãƒˆãƒƒãƒ—</a></li>
                <li><a href="admin.html">ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</a></li>
            </ul>
        </nav>
    </header>

    <div class="dashboard-container">
        <h1 class="section-title">æ´»å‹•è³‡é‡‘ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" style="color: green;" id="totalIncome">Â¥0</div>
                <div class="stat-label">ç·åå…¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: red;" id="totalExpense">Â¥0</div>
                <div class="stat-label">ç·æ”¯å‡º</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--primary-blue);" id="balance">Â¥0</div>
                <div class="stat-label">æ®‹é«˜</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡º</h3>
            <div id="categoryChartContainer">
                <canvas id="categoryChart"></canvas>
            </div>
            <div id="categoryNoData" class="no-data hidden">
                æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
            </div>
        </div>

        <div class="chart-container">
            <h3>æœˆåˆ¥åæ”¯æ¨ç§»</h3>
            <div id="monthlyChartContainer">
                <canvas id="monthlyChart"></canvas>
            </div>
            <div id="monthlyNoData" class="no-data hidden">
                åæ”¯ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'student_council_data';

        function getTransactions() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        function calculateStats() {
            const transactions = getTransactions();
            let totalIncome = 0;
            let totalExpense = 0;

            transactions.forEach(t => {
                if (t.type === 'income') {
                    totalIncome += t.amount;
                } else {
                    totalExpense += t.amount;
                }
            });

            document.getElementById('totalIncome').textContent = `Â¥${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `Â¥${totalExpense.toLocaleString()}`;
            document.getElementById('balance').textContent = `Â¥${(totalIncome - totalExpense).toLocaleString()}`;

            return { transactions, totalIncome, totalExpense };
        }

        function renderCharts() {
            const { transactions } = calculateStats();

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡º
            const expenseByCategory = {};
            transactions.filter(t => t.type === 'expense').forEach(t => {
                expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
            });

            if (Object.keys(expenseByCategory).length > 0) {
                document.getElementById('categoryNoData').classList.add('hidden');
                document.getElementById('categoryChartContainer').classList.remove('hidden');
                
                new Chart(document.getElementById('categoryChart'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(expenseByCategory),
                        datasets: [{
                            data: Object.values(expenseByCategory),
                            backgroundColor: [
                                '#0066ff', '#0080ff', '#00b4ff', '#00d9ff', '#6366f1', '#9333ea'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            } else {
                document.getElementById('categoryNoData').classList.remove('hidden');
                document.getElementById('categoryChartContainer').classList.add('hidden');
            }

            // æœˆåˆ¥åæ”¯
            const monthlyData = {};
            transactions.forEach(t => {
                const month = t.date.substring(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') {
                    monthlyData[month].income += t.amount;
                } else {
                    monthlyData[month].expense += t.amount;
                }
            });

            const months = Object.keys(monthlyData).sort();
            if (months.length > 0) {
                document.getElementById('monthlyNoData').classList.add('hidden');
                document.getElementById('monthlyChartContainer').classList.remove('hidden');
                
                new Chart(document.getElementById('monthlyChart'), {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'åå…¥',
                                data: months.map(m => monthlyData[m].income),
                                backgroundColor: 'rgba(0, 255, 0, 0.5)'
                            },
                            {
                                label: 'æ”¯å‡º',
                                data: months.map(m => monthlyData[m].expense),
                                backgroundColor: 'rgba(255, 0, 0, 0.5)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } else {
                document.getElementById('monthlyNoData').classList.remove('hidden');
                document.getElementById('monthlyChartContainer').classList.add('hidden');
            }
        }

        renderCharts();
    </script>
</body>
</html>

